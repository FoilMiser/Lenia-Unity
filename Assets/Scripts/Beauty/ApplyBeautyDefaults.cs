namespace LeniaBeauty{using UnityEngine;using System;using System.Reflection;using System.Collections;public class ApplyBeautyDefaults:MonoBehaviour{[RuntimeInitializeOnLoadMethod(RuntimeInitializeLoadType.AfterSceneLoad)]static void Install(){var go=new GameObject("LeniaBeautyDefaults");UnityEngine.Object.DontDestroyOnLoad(go);go.AddComponent<ApplyBeautyDefaults>();}IEnumerator Start(){yield return new WaitForSeconds(0.75f);ApplyAll();yield return new WaitForEndOfFrame();ApplyAll();}void ApplyAll(){int hit=0;var list=UnityEngine.Object.FindObjectsByType<MonoBehaviour>(FindObjectsInactive.Include,FindObjectsSortMode.None);foreach(var mb in list){bool touched=false;touched|=TrySetGradient(mb,BuildNeon());touched|=TrySetMany(mb,new[]{"DispExposure","Exposure","dispExposure"},new object[]{5.8f,5.8f,5.8f});touched|=TrySetMany(mb,new[]{"DispGamma","Gamma","dispGamma"},new object[]{1.05f,1.05f,1.05f});touched|=TrySetMany(mb,new[]{"PaletteScale","paletteScale"},new object[]{0.84f,0.84f});touched|=TrySetMany(mb,new[]{"PaletteOffset","paletteOffset"},new object[]{0f,0f});touched|=TrySetMany(mb,new[]{"UseEdges"},new object[]{true});touched|=TrySetMany(mb,new[]{"EdgeStrength"},new object[]{0.45f});touched|=TrySetMany(mb,new[]{"EdgeThreshold"},new object[]{0.0105f});touched|=TrySetMany(mb,new[]{"UseTrail"},new object[]{true});touched|=TrySetMany(mb,new[]{"TrailDecay"},new object[]{0.985f});touched|=TrySetMany(mb,new[]{"TrailWeight"},new object[]{0.62f});touched|=TrySetMany(mb,new[]{"TrailBoost"},new object[]{1.5f});touched|=TrySetMany(mb,new[]{"UseGlow"},new object[]{true});touched|=TrySetMany(mb,new[]{"GlowThreshold"},new object[]{0.32f});touched|=TrySetMany(mb,new[]{"GlowSigma"},new object[]{2.8f});touched|=TrySetMany(mb,new[]{"GlowStrength"},new object[]{0.85f});if(touched){TryInvoke(mb,new[]{"RebuildLUT","RebuildLut","RebuildPalette","ApplyPalette","ApplyParams","Apply","OnValidate"});hit++;}}var cam=Camera.main;if(cam){cam.allowHDR=true;cam.clearFlags=CameraClearFlags.SolidColor;cam.backgroundColor=FromHex("#02040A");}Debug.Log($"[Beauty] Applied to {hit} components");}bool TrySetMany(MonoBehaviour t,string[] keys,object[] vals){bool any=false;for(int i=0;i<keys.Length&&i<vals.Length;i++){if(TrySet(t,keys[i],vals[i]))any=true;}return any;}bool TrySet(MonoBehaviour t,string key,object val){var tp=t.GetType();var f=tp.GetField(key,BindingFlags.Instance|BindingFlags.Public|BindingFlags.NonPublic|BindingFlags.IgnoreCase);if(f!=null){try{f.SetValue(t,ConvertTo(val,f.FieldType));return true;}catch{}}var p=tp.GetProperty(key,BindingFlags.Instance|BindingFlags.Public|BindingFlags.NonPublic|BindingFlags.IgnoreCase);if(p!=null&&p.CanWrite){try{p.SetValue(t,ConvertTo(val,p.PropertyType));return true;}catch{}}return false;}bool TrySetGradient(MonoBehaviour t,Gradient g){var tp=t.GetType();foreach(var name in new[]{"palette","Palette","gradient","Gradient"}){var f=tp.GetField(name,BindingFlags.Instance|BindingFlags.Public|BindingFlags.NonPublic|BindingFlags.IgnoreCase);if(f!=null&&f.FieldType==typeof(Gradient)){try{f.SetValue(t,g);}catch{}return true;}var p=tp.GetProperty(name,BindingFlags.Instance|BindingFlags.Public|BindingFlags.NonPublic|BindingFlags.IgnoreCase);if(p!=null&&p.CanWrite&&p.PropertyType==typeof(Gradient)){try{p.SetValue(t,g);}catch{}return true;}}return false;}void TryInvoke(MonoBehaviour t,string[] names){var tp=t.GetType();foreach(var n in names){var m=tp.GetMethod(n,BindingFlags.Instance|BindingFlags.Public|BindingFlags.NonPublic|BindingFlags.IgnoreCase,System.Type.DefaultBinder,System.Type.EmptyTypes,null);if(m!=null){try{m.Invoke(t,null);}catch{}}}}object ConvertTo(object v,System.Type t){if(t==typeof(Color)){if(v is string s&&ColorUtility.TryParseHtmlString(s,out var c))return c;if(v is Color c2)return c2;}if(t.IsEnum)return System.Enum.ToObject(t,v);return System.Convert.ChangeType(v,t);}Color FromHex(string hex){Color c;if(!ColorUtility.TryParseHtmlString(hex,out c))c=Color.black;return c;}Gradient BuildNeon(){var g=new Gradient();g.SetKeys(new[]{new GradientColorKey(FromHex("#000005"),0f),new GradientColorKey(FromHex("#00141C"),0.05f),new GradientColorKey(FromHex("#0AE7FF"),0.30f),new GradientColorKey(FromHex("#FFFFFF"),0.55f),new GradientColorKey(FromHex("#FF66FF"),0.80f),new GradientColorKey(FromHex("#2A002A"),1f)},new[]{new GradientAlphaKey(1f,0f),new GradientAlphaKey(1f,1f)});return g;}}}
